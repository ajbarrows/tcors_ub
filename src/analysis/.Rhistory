"total_nic" = total_nic_fit
)
get_coefs <- function(model_vector) {
coefs <- data.frame()
for (m in 1:length(model_vector)) {
tmp <- as.data.frame(coef(model_vector[[m]]))
tmp <- cbind(tmp, as.data.frame(coef(summary(model_vector[[m]]))[,4]) )
tmp$model <- names(model_vector[m])
tmp <- tmp %>% tibble::rownames_to_column()
names(tmp) <- c("feature", "beta", "p_val", "model")
coefs <- rbind(coefs, tmp)
}
coefs %>%
mutate(sig = case_when(
p_val < .05 ~ "*",
p_val < .01 ~ "**",
p_val < .001 ~ "***"
))
}
coefs <- get_coefs(models)
coefs_plt <- coefs %>%
filter(feature != "(Intercept)") %>%
tidyr::separate(
col = model,
into = c("outcome", "model")
) %>%
mutate(model = factor(model, levels = c("og", "new", "nic")))
coefs_plt %>%
filter(outcome == "study") %>%
ggplot(aes(y = feature, x = beta, fill = model, label = sig)) +
geom_col(position = "dodge") +
geom_text(aes(x = beta + 0.5), position = position_dodge(width = 0.9))
models <- list(
"study_og" = study_og_fit,
"study_new"=  study_new_fit,
"study_nic" = study_nic_fit,
"total_og" = total_og_fit,
"total_new" = total_new_fit,
"total_nic" = total_nic_fit
)
get_coefs <- function(model_vector) {
coefs <- data.frame()
for (m in 1:length(model_vector)) {
tmp <- as.data.frame(coef(model_vector[[m]]))
tmp <- cbind(tmp, as.data.frame(coef(summary(model_vector[[m]]))[,4]) )
tmp$model <- names(model_vector[m])
tmp <- tmp %>% tibble::rownames_to_column()
names(tmp) <- c("feature", "beta", "p_val", "model")
coefs <- rbind(coefs, tmp)
}
coefs %>%
mutate(sig = case_when(
p_val < .05 ~ "*",
p_val < .01 ~ "**",
p_val < .001 ~ "***"
))
}
coefs <- get_coefs(models)
View(coefs)
coefs <- data.frame()
for (m in 1:length(model_vector)) {
tmp <- as.data.frame(coef(model_vector[[m]]))
tmp <- cbind(tmp, as.data.frame(coef(summary(model_vector[[m]]))[,4]) )
tmp$model <- names(model_vector[m])
tmp <- tmp %>% tibble::rownames_to_column()
names(tmp) <- c("feature", "beta", "p_val", "model")
coefs <- rbind(coefs, tmp)
}
coefs
str(coefs)
coefs %>%
mutate(sig = case_when(
p_val < .05 ~ "*",
p_val < .01 ~ "**",
p_val < .001 ~ "***"
))
}
coefs %>%
mutate(sig = case_when(
p_val < .05 ~ "*",
p_val < .01 ~ "**",
p_val < .001 ~ "***"
))
models <- list(
"study_og" = study_og_fit,
"study_new"=  study_new_fit,
"study_nic" = study_nic_fit,
"total_og" = total_og_fit,
"total_new" = total_new_fit,
"total_nic" = total_nic_fit
)
get_coefs <- function(model_vector) {
coefs <- data.frame()
for (m in 1:length(model_vector)) {
tmp <- as.data.frame(coef(model_vector[[m]]))
tmp <- cbind(tmp, as.data.frame(coef(summary(model_vector[[m]]))[,4]) )
tmp$model <- names(model_vector[m])
tmp <- tmp %>% tibble::rownames_to_column()
names(tmp) <- c("feature", "beta", "p_val", "model")
coefs <- rbind(coefs, tmp)
}
coefs %>%
mutate(sig = case_when(
p_val < .001 ~ "***",
p_val < .01 ~ "**",
p_val < .05 ~ "*"
))
}
coefs <- get_coefs(models)
coefs_plt <- coefs %>%
filter(feature != "(Intercept)") %>%
tidyr::separate(
col = model,
into = c("outcome", "model")
) %>%
mutate(model = factor(model, levels = c("og", "new", "nic")))
coefs_plt %>%
filter(outcome == "study") %>%
ggplot(aes(y = feature, x = beta, fill = model, label = sig)) +
geom_col(position = "dodge") +
geom_text(aes(x = beta + 0.5), position = position_dodge(width = 0.9))
anova(total_nic_fit)
cor(w12_nomiss)
coefs_plt <- coefs %>%
filter(feature != "(Intercept)") %>%
tidyr::separate(
col = model,
into = c("outcome", "model")
) %>%
mutate(model = factor(model, levels = c("og", "new", "nic")))
coefs_plt %>%
filter(outcome == "study") %>%
ggplot(aes(y = feature, x = beta, fill = model, label = sig)) +
geom_col(position = "dodge") +
geom_text(aes(x = beta + 0.5), position = position_dodge(width = 0.9)) +
labs(
title = "TCORS Study 2 GLMs"
)
cor(w12_nomiss$baseline_cpd[w12_nomiss$week == "week0"], w12_nomiss$carmine_nicotine)
bl <- w12_nomiss[w12_nomiss$week == "week0"]
cor(bl$baseline_cpd, bl$carmine_nicotine)
bl <- w12_nomiss[w12_nomiss$week == "week0"]
bl
w12_nomiss[w12_nomiss$week == "week0", ]
w12_nomiss[,w12_nomiss$week == "week0"]
w12_nomiss$week == "week0"
cor(w12_nomiss$baseline_cpd, w12_nomiss$carmine_nicotine)
plot(w12_nomiss$baseline_cpd, w12_nomiss$carmine_nicotine)
cor(w12_nomiss$baseline_cpd, w12_nomiss$carmine_nicotine)
plot(w12_nomiss$carmine_nicotine, w12_nomiss$baseline_cpd)
plot(w12_nomiss$carmine_nicotine, w12_nomiss$baseline_cpd)
abline(lm(baseline_cpd ~ carmine_nicotine, data = w12_nomiss))
ggplot(w12_nomiss, aes(x = carmine_nicotine, y = baseline_cpd)) +
geom_smooth()
ggplot(w12_nomiss, aes(x = carmine_nicotine, y = baseline_cpd)) +
geom_smooth(method = 'lm', formula = y~x)
ggplot(w12_nomiss, aes(x = carmine_nicotine, y = baseline_cpd)) +
geom_point() +
geom_smooth(method = 'lm', formula = y~x, se = FALSE)
w12_nomiss %>%
select(baseline_cpd, total_cpd, study_mean) %>%
tidyr::pivot_longer()
w12_nomiss %>%
select(screen_id, baseline_cpd, total_cpd, study_mean) %>%
tidyr::pivot_longer(-screen_id)
w12_nomiss %>%
select(screen_id, carmine_nicotine, baseline_cpd, total_cpd, study_mean) %>%
tidyr::pivot_longer(-c(screen_id, carmine_nicotine))
w12_nomiss %>%
select(screen_id, carmine_nicotine, baseline_cpd, total_cpd, study_mean) %>%
tidyr::pivot_longer(-c(screen_id, carmine_nicotine))
w12_nomiss %>%
select(screen_id, carmine_nicotine, baseline_cpd, total_cpd, study_mean) %>%
tidyr::pivot_longer(-c(screen_id, carmine_nicotine)) %>%
ggplot(aes(x = carmine_nicotine, y = value)) +
geom_point() +
facet_wrap(~name) +
geom_smooth(method = 'lm', formula = y~x, se = FALSE)
w12_nomiss %>%
select(screen_id, carmine_nicotine, baseline_cpd, total_cpd, study_mean) %>%
tidyr::pivot_longer(-c(screen_id, carmine_nicotine)) %>%
ggplot(aes(x = carmine_nicotine, y = value)) +
geom_point() +
facet_wrap(~name, ncol = 1) +
geom_smooth(method = 'lm', formula = y~x, se = FALSE)
View(w12_nomiss)
w12_nomiss %>%
select(screen_id, carmine_nicotine, baseline_cpd, total_cpd, study_mean) %>%
tidyr::pivot_longer(-c(screen_id, carmine_nicotine))
w12_nomiss %>%
select(screen_id, carmine_nicotine, baseline_cpd, total_cpd, study_mean) %>%
tidyr::pivot_longer(-c(screen_id, carmine_nicotine)) %>%
ggplot(aes(x = carmine_nicotine, y = value)) +
geom_point() +
geom_smooth(method = 'lm', formula = y~x, se = FALSE) +
facet_wrap(~name, ncol = 1)
w12_nomiss %>%
select(screen_id, carmine_nicotine, baseline_cpd, total_cpd, study_mean) %>%
tidyr::pivot_longer(-c(screen_id, carmine_nicotine)) %>%
ggplot(aes(x = carmine_nicotine, y = value)) +
geom_point() +
stat_poly_line() +
# geom_smooth(method = 'lm', formula = y~x, se = FALSE) +
facet_wrap(~name, ncol = 1)
install.packages("ggpmisc")
w12_nomiss %>%
select(screen_id, carmine_nicotine, baseline_cpd, total_cpd, study_mean) %>%
tidyr::pivot_longer(-c(screen_id, carmine_nicotine)) %>%
ggplot(aes(x = carmine_nicotine, y = value)) +
geom_point() +
ggpmisc::stat_poly_line() +
# geom_smooth(method = 'lm', formula = y~x, se = FALSE) +
facet_wrap(~name, ncol = 1)
w12_nomiss %>%
select(screen_id, carmine_nicotine, baseline_cpd, total_cpd, study_mean) %>%
tidyr::pivot_longer(-c(screen_id, carmine_nicotine)) %>%
ggplot(aes(x = carmine_nicotine, y = value)) +
geom_point() +
ggpmisc::stat_poly_line() +
ggpmisc::stat_poly_eq() +
# geom_smooth(method = 'lm', formula = y~x, se = FALSE) +
facet_wrap(~name, ncol = 1)
coefs_plt <- coefs %>%
filter(feature != "(Intercept)") %>%
tidyr::separate(
col = model,
into = c("outcome", "model")
) %>%
mutate(model = factor(model, levels = c("og", "new", "nic")))
coefs_plt %>%
filter(outcome == "study") %>%
ggplot(aes(y = feature, x = beta, fill = model, label = sig)) +
geom_col(position = "dodge") +
geom_text(aes(x = beta + 0.5), position = position_dodge(width = 0.9)) +
labs(
title = "TCORS Study 2 GLMs"
)
ggsave("../figures/full_glm.png", dpi = "retina")
w12_nomiss %>%
select(screen_id, carmine_nicotine, baseline_cpd, total_cpd, study_mean) %>%
tidyr::pivot_longer(-c(screen_id, carmine_nicotine)) %>%
ggplot(aes(x = carmine_nicotine, y = value)) +
geom_point() +
ggpmisc::stat_poly_line() +
ggpmisc::stat_poly_eq() +
facet_wrap(~name, ncol = 1) +
labs(
title = "Correlation* Between UB Nic. and CPD",
caption = "* Lack thereof",
y = "Avg. Cigarettes Per Day",
x = "Usual Brand Nicotine Content (mg/g)"
)
w12_recode %>%
select(screen_id, trt_recode, carmine_nicotine, baseline_cpd, total_cpd, study_mean) %>%
tidyr::pivot_longer(-c(screen_id, trt_recode, carmine_nicotine)) %>%
ggplot(aes(x = carmine_nicotine, y = value)) +
geom_point() +
ggpmisc::stat_poly_line() +
ggpmisc::stat_poly_eq() +
facet_wrap(trt_recode~name, ncol = 1) +
labs(
title = "Correlation* Between UB Nic. and CPD",
caption = "* Lack thereof",
y = "Avg. Cigarettes Per Day",
x = "Usual Brand Nicotine Content (mg/g)"
)
w12_recode %>%
select(screen_id, trt_recode, carmine_nicotine, baseline_cpd, total_cpd, study_mean) %>%
tidyr::pivot_longer(-c(screen_id, trt_recode, carmine_nicotine)) %>%
ggplot(aes(x = carmine_nicotine, y = value)) +
geom_point() +
ggpmisc::stat_poly_line() +
ggpmisc::stat_poly_eq() +
facet_wrap(trt_recode~name) +
labs(
title = "Correlation* Between UB Nic. and CPD",
caption = "* Lack thereof",
y = "Avg. Cigarettes Per Day",
x = "Usual Brand Nicotine Content (mg/g)"
)
w12_recode %>%
select(screen_id, trt_recode, carmine_nicotine, baseline_cpd, total_cpd, study_mean) %>%
tidyr::pivot_longer(-c(screen_id, trt_recode, carmine_nicotine)) %>%
ggplot(aes(x = carmine_nicotine, y = value)) +
geom_point() +
ggpmisc::stat_poly_line() +
ggpmisc::stat_poly_eq() +
facet_grid(rows = vars(name), cols = vars(trt_recode)) +
labs(
title = "Correlation* Between UB Nic. and CPD",
caption = "* Lack thereof",
y = "Avg. Cigarettes Per Day",
x = "Usual Brand Nicotine Content (mg/g)"
)
w12_recode %>%
select(screen_id, trt_recode, carmine_nicotine, baseline_cpd, total_cpd, study_mean) %>%
tidyr::pivot_longer(-c(screen_id, trt_recode, carmine_nicotine)) %>%
ggplot(aes(x = carmine_nicotine, y = value)) +
geom_point() +
ggpmisc::stat_poly_line(se = FALSE) +
ggpmisc::stat_poly_eq() +
facet_grid(rows = vars(name), cols = vars(trt_recode)) +
labs(
title = "Correlation* Between UB Nic. and CPD",
caption = "* Lack thereof",
y = "Avg. Cigarettes Per Day",
x = "Usual Brand Nicotine Content (mg/g)"
)
w12_recode %>%
select(screen_id, trt_recode, carmine_nicotine, baseline_cpd, total_cpd, study_mean) %>%
tidyr::pivot_longer(-c(screen_id, trt_recode, carmine_nicotine)) %>%
ggplot(aes(x = carmine_nicotine, y = value)) +
geom_point() +
ggpmisc::stat_poly_line(se = FALSE) +
ggpmisc::stat_poly_eq() +
facet_grid(rows = vars(name), cols = vars(trt_recode)) +
labs(
title = "Correlation* Between UB Nic. and CPD",
caption = "* Lack thereof",
y = "Avg. Cigarettes Per Day",
x = "Usual Brand Nicotine Content (mg/g)"
)
ggsave("../figures/ub_nic_cor.png", dpi = "retina")
w12_recode
library(dplyr)
library(ggplot2)
theme_set(theme_classic())
load("../../data/clean/s2_data.RData")
w12_subset <- df %>% filter(week == "week12")
n_w12 <- w12_subset %>% count(screen_id) %>% nrow()
n_nicotine <- w12_subset %>% filter(!is.na(carmine_nicotine)) %>% nrow()
w12_nomiss <- w12_subset %>%
filter(!is.na(carmine_nicotine))
w12_nomiss$carmine_nic_scaled <- scale(w12_nomiss$carmine_nicotine)
# study
ff_study <- study_mean ~ dose + baseline_cpd + screen_age + screen_sex + menthol_status + project
study_og_fit <- lm(ff_study, data = w12_subset)
summary(study_og_fit)
# total
ff_total <- total_cpd ~ dose + baseline_cpd + screen_age + screen_sex + menthol_status + project
total_og_fit <- lm(ff_total, data = w12_subset)
summary(total_og_fit)
# study
study_new_fit <- lm(ff_study, data = w12_nomiss)
summary(study_new_fit)
# total CPD
total_new_fit <- lm(ff_total, data = w12_nomiss)
summary(total_new_fit)
ff_study_nic <- study_mean ~ dose + baseline_cpd + screen_age + screen_sex + menthol_status + project + carmine_nic_scaled
study_nic_fit <- lm(ff_study_nic, data = w12_nomiss)
summary(study_nic_fit)
ff_total_nic <- total_cpd ~ dose + baseline_cpd + screen_age + screen_sex + menthol_status + project + carmine_nic_scaled
total_nic_fit <- lm(ff_total_nic, data = w12_nomiss)
summary(total_nic_fit)
models <- list(
"study_og" = study_og_fit,
"study_new"=  study_new_fit,
"study_nic" = study_nic_fit,
"total_og" = total_og_fit,
"total_new" = total_new_fit,
"total_nic" = total_nic_fit
)
get_coefs <- function(model_vector) {
coefs <- data.frame()
for (m in 1:length(model_vector)) {
tmp <- as.data.frame(coef(model_vector[[m]]))
tmp <- cbind(tmp, as.data.frame(coef(summary(model_vector[[m]]))[,4]) )
tmp$model <- names(model_vector[m])
tmp <- tmp %>% tibble::rownames_to_column()
names(tmp) <- c("feature", "beta", "p_val", "model")
coefs <- rbind(coefs, tmp)
}
coefs %>%
mutate(sig = case_when(
p_val < .001 ~ "***",
p_val < .01 ~ "**",
p_val < .05 ~ "*"
))
}
coefs <- get_coefs(models)
coefs_plt <- coefs %>%
filter(feature != "(Intercept)") %>%
tidyr::separate(
col = model,
into = c("outcome", "model")
) %>%
mutate(model = factor(model, levels = c("og", "new", "nic")))
coefs_plt %>%
filter(outcome == "study") %>%
ggplot(aes(y = feature, x = beta, fill = model, label = sig)) +
geom_col(position = "dodge") +
geom_text(aes(x = beta + 0.5), position = position_dodge(width = 0.9)) +
labs(
title = "TCORS Study 2 GLMs"
)
ggsave("../figures/full_glm.png", dpi = "retina")
w12_recode %>%
mutate(delta_cpd = total_cpd - baseline_cpd) %>%
select(screen_id, trt_recode, carmine_nicotine, baseline_cpd, total_cpd, study_mean, delta_cpd)
w12_recode %>%
mutate(delta_cpd = total_cpd - baseline_cpd) %>%
select(screen_id, trt_recode, carmine_nicotine, baseline_cpd, total_cpd, study_mean, delta_cpd) %>%
tidyr::pivot_longer(-c(screen_id, trt_recode, carmine_nicotine)) %>%
ggplot(aes(x = carmine_nicotine, y = value)) +
geom_point() +
ggpmisc::stat_poly_line(se = FALSE) +
ggpmisc::stat_poly_eq() +
facet_grid(rows = vars(name), cols = vars(trt_recode)) +
labs(
title = "Correlation* Between UB Nic. and CPD",
caption = "* Lack thereof",
y = "Avg. Cigarettes Per Day",
x = "Usual Brand Nicotine Content (mg/g)"
)
ggsave("../figures/ub_nic_cor.png", dpi = "retina")
w12_recode %>%
mutate(delta_cpd = total_cpd - baseline_cpd) %>%
select(screen_id, trt_recode, carmine_nicotine, baseline_cpd, total_cpd, study_mean, delta_cpd) %>%
tidyr::pivot_longer(-c(screen_id, trt_recode, carmine_nicotine))
w12_recode %>%
mutate(delta_cpd = total_cpd - baseline_cpd)
w12_recode %>%
mutate(delta_cpd = total_cpd - baseline_cpd)
w12_recode %>%
mutate(delta_cpd = total_cpd - baseline_cpd) %>%
select(carmine_nicotine, delta_cpd)
w12_recode %>%
mutate(delta_cpd = total_cpd - baseline_cpd) %>%
select(carmine_nicotine, delta_cpd) %>%
cor()
w12_recode %>%
mutate(delta_cpd = total_cpd - baseline_cpd) %>%
select(carmine_nicotine, delta_cpd) %>%
cor(na.rm = TRUE)
w12_recode %>%
mutate(delta_cpd = total_cpd - baseline_cpd) %>%
select(carmine_nicotine, delta_cpd) %>%
cor(use = "complete.obs")
w12_recode %>%
mutate(delta_cpd = total_cpd - baseline_cpd) %>%
select(carmine_nicotine, delta_cpd) %>%
cor(use = "complete.obs", type = "spearman")
w12_recode %>%
mutate(delta_cpd = total_cpd - baseline_cpd) %>%
select(carmine_nicotine, delta_cpd) %>%
cor(use = "complete.obs", method = "spearman")
w12_recode %>%
mutate(delta_cpd = total_cpd - baseline_cpd) %>%
select(carmine_nicotine, baseline_cpd) %>%
cor(use = "complete.obs", method = "spearman")
w12_recode %>%
mutate(delta_cpd = total_cpd - baseline_cpd) %>%
select(carmine_nicotine, baseline_cpd)
w12_recode %>%
mutate(delta_cpd = total_cpd - baseline_cpd) %>%
select(carmine_nicotine, baseline_cpd) %>%
plot()
w12_recode %>%
mutate(delta_cpd = total_cpd - baseline_cpd) %>%
select(log(carmine_nicotine), baseline_cpd) %>%
plot()
w12_recode %>%
mutate(delta_cpd = total_cpd - baseline_cpd) %>%
select(log(carmine_nicotine), baseline_cpd) %>%
plot()
w12_recode %>%
mutate(delta_cpd = total_cpd - baseline_cpd) %>%
select(ln(carmine_nicotine), baseline_cpd) %>%
plot()
w12_recode %>%
mutate(log_nic = log(carmine_nicotine)) %>%
select(log_nic, baseline_cpd)
w12_recode %>%
mutate(log_nic = log(carmine_nicotine)) %>%
select(log_nic, baseline_cpd) %>%
plot()
w12_recode %>%
mutate(log_nic = log(carmine_nicotine)) %>%
select(log_nic, baseline_cpd) %>%
plot()
cor(use = "complete.obs", method = "pearson")
w12_recode %>%
mutate(log_nic = log(carmine_nicotine)) %>%
select(log_nic, baseline_cpd) %>%
cor(use = "complete.obs", method = "pearson")
w12_recode %>%
mutate(log_nic = log(carmine_nicotine)) %>%
select(log_nic, adherence) %>%
cor(use = "complete.obs", method = "pearson")
#
#   select(screen_id, trt_recode, carmine_nicotine, baseline_cpd, total_cpd, study_mean, delta_cpd) %>%
#   tidyr::pivot_longer(-c(screen_id, trt_recode, carmine_nicotine)) %>%
#   ggplot(aes(x = carmine_nicotine, y = value)) +
#   geom_point() +
#   ggpmisc::stat_poly_line(se = FALSE) +
#   ggpmisc::stat_poly_eq() +
#   facet_grid(rows = vars(name), cols = vars(trt_recode)) +
#   labs(
#     title = "Correlation* Between UB Nic. and CPD",
#     caption = "* Lack thereof",
#     y = "Avg. Cigarettes Per Day",
#     x = "Usual Brand Nicotine Content (mg/g)"
#   )
# ggsave("../figures/ub_nic_cor.png", dpi = "retina")
w12_recode %>%
mutate(log_nic = log(carmine_nicotine)) %>%
select(log_nic, adherence) %>%
plot()
w12_recode %>%
mutate(log_nic = log(carmine_nicotine)) %>%
select(carmine_nicotine, adherence) %>%
plot()
